<h2>Categories</h2>
<ul>
  <% @categories.each do |category| %>
    <li>
      <%= link_to category.name, store_category_path(category) %>
    </li>
  <% end %>
</ul>

<p>
  <%= link_to "New Products", store_new_products_path %> |
  <%= link_to "On Sale", store_on_sale_path %> |
  <%= link_to "All", store_path %>
</p>

<%= form_with url: store_search_path, method: :get, local: true do %>
  <div class="form-group">
    <%= label_tag :query, "Search Products" %>
    <%= text_field_tag :query, params[:query], class: "form-control", placeholder: "Enter keyword..." %>
  </div>

  <div class="form-group">
    <%= label_tag :category_id, "Filter by Category" %>
    <%= select_tag :category_id, options_from_collection_for_select(@categories, :id, :name, params[:category_id]), include_blank: "All Categories", class: "form-control" %>
  </div>

  <%= submit_tag "Search", class: "btn btn-primary mt-2" %>
<% end %>

<h1>All Products</h1>

<div class="row">
  <% @products.each do |product| %>
    <div class="col-md-4 mb-4">
      <div class="card">
        <% if product.image.attached? %>
          <%= image_tag rails_blob_url(product.image, host: "http://localhost:3000"), class: "card-img-top" %>
        <% else %>
          <p class="text-center mt-3">No Image</p>
        <% end %>

        <div class="card-body">
          <h5 class="card-title"><%= product.name %></h5>
          <p><%= truncate(product.description, length: 100) %></p>
          <% if product.on_sale && product.sale_price.present? %>
            <p>
              <strong>Sale Price:</strong> $<%= product.sale_price %><br>
              <small><del>$<%= product.price %></del></small>
            </p>
          <% else %>
            <p><strong>Price:</strong> $<%= product.price %></p>
          <% end %>
          <%= link_to "View Details", store_product_path(product), class: "btn btn-primary" %>
        </div>
      </div>
    </div>
  <% end %>
</div>

<!-- âœ… Pagination placed after the products grid -->
<div class="d-flex justify-content-center mt-4">
  <%= paginate @products %>
</div>
